# Триггеры

Большая часть сервисных операций должна выполняться триггерами и внешними ключами. Сейчас триггеры делают следующее:

## При создании пользователя/группы

- Создаётся собственный фид;
- Если пользователь не группа:
    + Создаётся директ-фид;
    + Создаются фильтрующие фиды:
        * Посты пользователя;
        * Посты, прокомментированные пользователем;
        * Посты, лайкнутые пользователем.
    + Создаётся агрегатор френдленты и подписывается на директ-фид пользователя, его собственный фид, фид прокомментированного и фид лайкнутого.

## При вставке/удалении в таблицу feed_posts

- Добавляется/удаляется id фида в поле `posts.feed_ids`. Само это поле явно изменять не нужно.

## При вставке/удалении в таблицу feed_readers

- Добавляется/удаляется id фида в поле `users.visible_private_feed_ids`. Само это поле явно изменять не нужно.

## При создании/удалении поста

- При создании поста он добавляется в фильтрующий фид «Все посты пользователя» для автора поста;
- При удалении поста он удаляется из таблиц внешними ключами.

## При создании/удалении комментария

Прокомментированный пост добавляется/удаляется (если надо) в фильтрующий фид «Посты, прокомментированные пользователем» для автора комментария.

## При создании/удалении лайка

Лайкнутый пост добавляется/удаляется (если надо) в фильтрующий фид «Посты, лайкнутые пользователем» для автора лайка.